<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Structure Validation</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        #network { width: 100%; height: 400px; border: 1px solid #333; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üß™ Real Data Structure Validation</h1>
    <p>Testing the exact data structure used in the process tracing system.</p>

    <div id="test-results"></div>
    <div id="network"></div>

    <script>
        function addTestResult(title, status, message, details = '') {
            const div = document.createElement('div');
            div.className = `test ${status}`;
            div.innerHTML = `
                <h3>${title}</h3>
                <p>${message}</p>
                ${details ? `<pre>${details}</pre>` : ''}
            `;
            document.getElementById('test-results').appendChild(div);
        }

        // Test the EXACT data structure from the real system
        function testRealDataStructure() {
            try {
                // EXACT nodes data from real system (simplified for testing)
                const nodes = new vis.DataSet([
                    {
                        "id": "event1", 
                        "label": "Event", 
                        "properties": {
                            "description": "The French and Indian War concluded in 1763 with a British victory, resulting in a substantial war debt for Britain",
                            "type": "triggering", 
                            "date": "1763", 
                            "is_point_in_time": true
                        }, 
                        "title": "French and Indian War (1763)\nTriggering event"
                    },
                    {
                        "id": "event2", 
                        "label": "Event", 
                        "properties": {
                            "description": "The British Parliament imposed new taxes on the American colonies",
                            "type": "intermediate", 
                            "date": "1765-1767", 
                            "is_point_in_time": false
                        }, 
                        "title": "British Taxation (1765-1767)\nIntermediate event"
                    },
                    {
                        "id": "hypothesis1", 
                        "label": "Hypothesis", 
                        "properties": {
                            "description": "British taxation policies directly caused the American Revolution",
                            "status": "supported"
                        }, 
                        "title": "Taxation Hypothesis\nSupported"
                    },
                    {
                        "id": "evidence1", 
                        "label": "Evidence", 
                        "properties": {
                            "description": "The Stamp Act Congress's Declaration of Rights and Grievances",
                            "type": "hoop", 
                            "source": "Wikipedia",
                            "probative_value": 0.7
                        }, 
                        "title": "Declaration of Rights\nHoop test evidence"
                    }
                ]);

                const edges = new vis.DataSet([
                    {
                        "from": "event1", 
                        "to": "event2", 
                        "label": "causes", 
                        "properties": {
                            "certainty": 0.8, 
                            "description": "War debt created conditions for taxation"
                        }, 
                        "title": "Causation (80% certainty)"
                    },
                    {
                        "from": "evidence1", 
                        "to": "hypothesis1", 
                        "label": "provides_evidence", 
                        "properties": {
                            "certainty": 0.7, 
                            "probative_value": 0.7
                        }, 
                        "title": "Evidence support (70% certainty)"
                    }
                ]);

                addTestResult(
                    "‚úÖ Data Structure Creation", 
                    "success", 
                    "vis.js DataSet objects created successfully with real system data structure"
                );

                // Test network creation
                const container = document.getElementById('network');
                const data = { nodes: nodes, edges: edges };
                const options = {
                    nodes: { 
                        shape: 'dot', 
                        size: 20, 
                        font: { size: 16 },
                        color: {
                            background: '#D2E5FF',
                            border: '#2B7CE9'
                        }
                    },
                    edges: { 
                        arrows: 'to', 
                        font: { align: 'middle' } 
                    },
                    physics: { 
                        stabilization: true,
                        barnesHut: {
                            gravitationalConstant: -2000,
                            centralGravity: 0.3,
                            springLength: 150,
                            springConstant: 0.04
                        }
                    }
                };

                const network = new vis.Network(container, data, options);

                addTestResult(
                    "‚úÖ Network Rendering", 
                    "success", 
                    "Network rendered successfully with real data structure"
                );

                // Test interactions
                network.on("click", function (params) {
                    if (params.nodes.length > 0) {
                        addTestResult(
                            "‚úÖ Click Interaction", 
                            "success", 
                            `Node clicked: ${params.nodes[0]}`
                        );
                    }
                });

                network.on("hoverNode", function (params) {
                    console.log('Hover detected:', params.node);
                });

                addTestResult(
                    "‚úÖ Event Handlers", 
                    "success", 
                    "Click and hover event handlers attached successfully"
                );

                return true;

            } catch (error) {
                addTestResult(
                    "‚ùå Data Structure Test Failed", 
                    "error", 
                    "Error creating network with real data structure: " + error.message,
                    error.stack
                );
                return false;
            }
        }

        // Run test when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Check vis.js availability
            if (typeof vis !== 'undefined') {
                addTestResult(
                    "‚úÖ vis.js Library", 
                    "success", 
                    "vis.js library loaded successfully"
                );
                
                // Test the real data structure
                testRealDataStructure();
                
            } else {
                addTestResult(
                    "‚ùå vis.js Library", 
                    "error", 
                    "vis.js library failed to load from CDN"
                );
            }
        });
    </script>
</body>
</html>